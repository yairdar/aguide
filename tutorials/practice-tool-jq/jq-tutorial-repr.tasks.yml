# https://taskfile.dev

version: '3'
vars:
  _me__git_repo_http_url: https://github.com/rjz/jq-tutorial.git
  _me__dir_name: jq-tutorial
  _me__dimg_lastname: jq-tutorial-dimg
tasks:
  
  resolve-source:
    desc: resolve (fetch) sources from git store
    cmds:
    - rm -rf '{{._me__dir_name}}'
    - git clone {{._me__git_repo_http_url}}
    generates:
    - '{{._me__dir_name}}/**/*'
    status:
    - '[ -e {{._me__dir_name}}/.git ]'
  
  build-dimg:
    desc: resolve (fetch) sources from git store
    sources:
    - '{{._me__dir_name}}/**/*'
    cmds:
    - docker build -t {{._me__dimg_lastname}} .

  resolve-dimg:
    desc: resolve dimg for tutorial
    cmds:
    - task: resolve-source
    - task: build-dimg

  start-tutorial:
    desc: Run Tutorial Series for jq tool. 
    preconditions:
    - sh: "docker image inspect {{._me__dimg_lastname}}"
      msg: "please resolve {{._me__dimg_lastname}} dimg"
    cmds:
    - docker run -ti {{._me__dimg_lastname}}
